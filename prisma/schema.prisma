generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Tenant {
  id           String        @id @default(cuid())
  name         String
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  candidates   Candidate[]
  jobs         Job[]
  users        User[]
}

model User {
  id          String   @id @default(cuid())
  tenantId    String
  clerkUserId String?  @unique
  email       String
  name        String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  jobs        Job[]    @relation("JobCreatedBy")
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@index([tenantId])
  @@index([clerkUserId])
}

model Job {
  id             String          @id @default(cuid())
  tenantId       String
  createdById    String
  title          String
  description    String?
  location       String?
  isRemote       Boolean         @default(false)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  applications   Application[]
  interviewSlots InterviewSlot[]
  createdBy      User            @relation("JobCreatedBy", fields: [createdById], references: [id])
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model Candidate {
  id           String        @id @default(cuid())
  tenantId     String
  email        String?
  phone        String?
  fullName     String?
  location     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  applications Application[]
  tenant       Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@unique([tenantId, phone])
  @@index([tenantId])
  @@index([tenantId, createdAt])
}

model Application {
  id          String           @id @default(cuid())
  tenantId    String
  jobId       String
  candidateId String
  stage       ApplicationStage @default(NEW)
  score       Int              @default(0)
  notes       String?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  answers     Answer[]
  candidate   Candidate        @relation(fields: [candidateId], references: [id], onDelete: Cascade)
  job         Job              @relation(fields: [jobId], references: [id], onDelete: Cascade)
  tenant      Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId, stage])
  @@index([jobId, stage])
  @@index([score])
}

model Answer {
  id            String      @id @default(cuid())
  applicationId String
  questionKey   String
  answerText    String?
  createdAt     DateTime    @default(now())
  application   Application @relation(fields: [applicationId], references: [id], onDelete: Cascade)

  @@index([applicationId])
  @@index([questionKey])
}

model InterviewSlot {
  id        String   @id @default(cuid())
  jobId     String
  startsAt  DateTime
  endsAt    DateTime
  isBooked  Boolean  @default(false)
  createdAt DateTime @default(now())
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([jobId, startsAt])
}

enum ApplicationStage {
  NEW
  SCREENED
  SHORTLISTED
  SCHEDULED
  INTERVIEWED
  OFFERED
  HIRED
  REJECTED
  DROPPED
}
